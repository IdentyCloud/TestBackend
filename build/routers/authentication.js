"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));require("dotenv").config();var _require=require("express"),Router=_require.Router,bcrypt=require("bcryptjs"),jwt=require("jsonwebtoken"),router=Router(),userModel=require("../models/users");router.post("/create-user",function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b,c){var d,e,f,g,h;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=b.body,e=d.username,f=d.password,a.prev=1,a.next=4,userModel.findOne({username:e});case 4:if(g=a.sent,!g){a.next=7;break}return a.abrupt("return",c.status(500).json("The user already exists"));case 7:return h=new userModel({username:e,password:f}),h.password=bcrypt.hashSync(f,10),a.next=11,h.save();case 11:return a.abrupt("return",c.status(200).json("the user ".concat(h.username," was created")));case 14:a.prev=14,a.t0=a["catch"](1),c.status(500).json(a.t0.message);case 17:case"end":return a.stop();}},a,null,[[1,14]])}));return function(){return a.apply(this,arguments)}}()),router.post("/authentication",function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b,c){var d,e,f,g,h;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=b.body,e=d.username,f=d.password,a.prev=1,a.next=4,userModel.findOne({username:e});case 4:if(g=a.sent,g){a.next=7;break}return a.abrupt("return",c.status(500).json("The user is incorrect"));case 7:if(bcrypt.compareSync(f,g.password)){a.next=11;break}return a.abrupt("return",c.status(500).json("The password is incorrect"));case 11:h=jwt.sign({_id:g._id},process.env.SECRET_TOKEN,{expiresIn:86400}),c.status(200).header("auth-token",h).json("The user ".concat(g.username," is correct."));case 13:a.next=18;break;case 15:a.prev=15,a.t0=a["catch"](1),c.status(500).json(a.t0.message);case 18:case"end":return a.stop();}},a,null,[[1,15]])}));return function(){return a.apply(this,arguments)}}()),module.exports=router;