"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));require("dotenv").config();var _require=require("express"),Router=_require.Router,jwt=require("jsonwebtoken"),router=Router(),movieModel=require("../models/movie"),accessToken=function(a,b,c){var d=a.headers["auth-token"];d?jwt.verify(d,process.env.SECRET_TOKEN,function(d,e){return d?b.status(400).json({mensaje:"The token is invalid"}):void(a.decoded=e,c())}):b.status(500).send({mensaje:"A Token is needed"})};router.post("/create-movie",accessToken,function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b,c){var d,e,f,g,h,i;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=b.body,e=d.name,f=d.director,g=d.actor,a.prev=1,a.next=4,movieModel.findOne({name:e,director:f,actor:g});case 4:if(h=a.sent,!h){a.next=7;break}return a.abrupt("return",c.status(500).json("The movie already exists"));case 7:return i=new movieModel({name:e,director:f,actor:g}),a.next=10,i.save();case 10:return a.abrupt("return",c.status(200).json("the movie ".concat(i.name," was created")));case 13:a.prev=13,a.t0=a["catch"](1),c.status(500).json(a.t0.message);case 16:case"end":return a.stop();}},a,null,[[1,13]])}));return function(){return a.apply(this,arguments)}}()),router.post("/filter/",accessToken,function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b,c){var d,e;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=b.query.name,a.prev=1,a.next=4,movieModel.find({name:{$eq:d}});case 4:return e=a.sent,a.abrupt("return",c.status(200).json(e));case 8:a.prev=8,a.t0=a["catch"](1),c.status(500).json(a.t0.message);case 11:case"end":return a.stop();}},a,null,[[1,8]])}));return function(){return a.apply(this,arguments)}}()),router.post("/filter/",accessToken,function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b,c){var d,e;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=b.query.name,a.prev=1,a.next=4,movieModel.find({name:{$eq:d}});case 4:return e=a.sent,a.abrupt("return",c.status(200).json(e));case 8:a.prev=8,a.t0=a["catch"](1),c.status(500).json(a.t0.message);case 11:case"end":return a.stop();}},a,null,[[1,8]])}));return function(){return a.apply(this,arguments)}}()),router.post("/sort/",accessToken,function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b,c){var d;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(d=b.query.order,a.prev=1,"ascendant"!=d){a.next=10;break}return a.t0=c.status(200),a.next=6,movieModel.find().sort({name:1});case 6:return a.t1=a.sent,a.abrupt("return",a.t0.json.call(a.t0,a.t1));case 10:return a.t2=c.status(200),a.next=13,movieModel.find().sort({name:-1});case 13:return a.t3=a.sent,a.abrupt("return",a.t2.json.call(a.t2,a.t3));case 15:a.next=20;break;case 17:a.prev=17,a.t4=a["catch"](1),c.status(500).json(a.t4.message);case 20:case"end":return a.stop();}},a,null,[[1,17]])}));return function(){return a.apply(this,arguments)}}()),module.exports=router;